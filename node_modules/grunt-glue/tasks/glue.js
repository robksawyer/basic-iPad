/**
 * grunt-glue - A wrapper for the glue spriting tool.
 * @see https://bitbucket.org/carkraus/grunt-glue
 * @see https://github.com/jorgebastida/glue
 *
 * Copyright (c) 2012 Carsten Kraus
 * Licensed under the MIT license.
 */

module.exports = function(grunt) {
  var exec = require('child_process').exec;

  // ==========================================================================
  // TASKS
  // ==========================================================================
  grunt.registerMultiTask('glue', 'A wrapper for the glue spriting tool.', function() {
    var done = this.async(),
        config = this.data,
        src = config.src,
        dest = config.dest,
        opts = config.options;
    // Build the command
    var cmd = ['glue', src];
    if(dest) cmd.push(dest);
    if(opts) cmd.push(opts);
    // grunt.log.debug(cmd.join(' '));

    // Execute
    exec(cmd.join(' '), function(err, stdout, stderr) {
      if (err) {
        throw err;
      }
      if (stderr) {
        done();
        return false;
      }
      done();
    });
  });
};
